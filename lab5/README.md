# Лабораторная работа № 5. Многофакторный регрессионный анализ

**Вариант 7. Часть 1**

## Оглавление
1. [Цель работы](#цель-работы)
2. [Теоретические основы](#теоретические-основы)
3. [Постановка задачи](#постановка-задачи)
4. [Исходные данные](#исходные-данные)
5. [Методика выполнения](#методика-выполнения)
6. [Результаты выполнения](#результаты-выполнения)
7. [Анализ результатов](#анализ-результатов)
8. [Выводы](#выводы)
9. [Запуск программы](#запуск-программы)

---

## Цель работы

Освоить методы многофакторного регрессионного анализа, научиться:
- Строить линейное уравнение регрессии в матричной форме
- Проверять адекватность модели по критерию Фишера
- Оценивать значимость факторов по критерию Стьюдента
- Выполнять селекцию факторов и строить оптимальные регрессионные модели

---

## Теоретические основы

### 1. Линейная регрессия

Линейная регрессионная модель для двух факторов имеет вид:

```
y = b₀ + b₁·x₁ + b₂·x₂ + ε
```

где:
- `y` — зависимая переменная (отклик)
- `x₁, x₂` — независимые переменные (факторы)
- `b₀` — свободный член
- `b₁, b₂` — коэффициенты регрессии
- `ε` — случайная ошибка

### 2. Центрирование переменных

Для упрощения расчетов применяется центрирование — вычитание средних значений:

```
x̃ᵢ = xᵢ - x̄ᵢ
ỹ = y - ȳ
```

Для центрированных переменных уравнение регрессии принимает вид:

```
ỹ = b₁·x̃₁ + b₂·x̃₂
```

(свободный член исчезает, так как среднее центрированных переменных равно нулю)

### 3. Матричная форма

В матричной форме задача решения регрессии записывается как система нормальных уравнений:

```
(X'X)b = X'Y
```

где:
- `X` — матрица факторов размера n×k (n — число наблюдений, k — число факторов)
- `Y` — вектор наблюдений размера n×1
- `b` — вектор коэффициентов размера k×1
- `X'` — транспонированная матрица X

Решение:

```
b = (X'X)⁻¹ X'Y
```

### 4. Критерий Фишера (F-тест)

Критерий Фишера проверяет **адекватность модели** в целом, т.е. насколько хорошо регрессионное уравнение описывает экспериментальные данные.

#### Суммы квадратов:

- **Общая сумма квадратов (SST):**
  ```
  SST = Σ(yᵢ - ȳ)²
  ```
  Характеризует общую изменчивость зависимой переменной.

- **Регрессионная сумма квадратов (SSR):**
  ```
  SSR = Σ(ŷᵢ - ȳ)²
  ```
  Характеризует изменчивость, объясненную регрессией.

- **Остаточная сумма квадратов (SSE):**
  ```
  SSE = Σ(yᵢ - ŷᵢ)²
  ```
  Характеризует необъясненную изменчивость (ошибку модели).

Справедливо соотношение: `SST = SSR + SSE`

#### F-статистика:

```
F = MSR / MSE = (SSR / df_reg) / (SSE / df_res)
```

где:
- `df_reg = k` — степени свободы регрессии (k — число факторов)
- `df_res = n - k - 1` — степени свободы остатков

#### Проверка гипотезы:

- **H₀:** Модель неадекватна (F ≤ F_критич)
- **H₁:** Модель адекватна (F > F_критич)

При уровне значимости α = 0.05:
- Если `F > F_критич(α, df_reg, df_res)`, то модель **адекватна**
- Иначе модель **неадекватна**

#### Коэффициент детерминации R²:

```
R² = SSR / SST = 1 - SSE / SST
```

Показывает долю дисперсии зависимой переменной, объясненную моделью. Изменяется от 0 до 1:
- R² ≈ 1 — модель отлично описывает данные
- R² ≈ 0 — модель плохо описывает данные

### 5. Критерий Стьюдента (t-тест)

Критерий Стьюдента проверяет **значимость отдельных факторов**, т.е. вносит ли данный фактор существенный вклад в модель.

#### Стандартные ошибки коэффициентов:

Для центрированных переменных:

```
Cov(b) = s² · (X'X)⁻¹
SE(bᵢ) = √(s² · [(X'X)⁻¹]ᵢᵢ)
```

где `s² = MSE` — оценка дисперсии ошибок.

#### t-статистика для коэффициента bᵢ:

```
t(bᵢ) = bᵢ / SE(bᵢ)
```

#### Проверка гипотезы:

- **H₀:** Фактор незначим (bᵢ = 0)
- **H₁:** Фактор значим (bᵢ ≠ 0)

При уровне значимости α = 0.05:
- Если `|t(bᵢ)| > t_критич(α/2, df_res)`, то фактор **значим**
- Иначе фактор **незначим** и может быть исключен из модели

### 6. Селекция факторов

Если по критерию Стьюдента некоторые факторы оказываются незначимыми:
1. Исключаем незначимые факторы из модели
2. Строим новую (редуцированную) регрессионную модель только со значимыми факторами
3. Повторно проверяем адекватность новой модели по критерию Фишера

---

## Постановка задачи

На основе заданного массива экспериментальных данных (вариант 7):
1. Построить уравнение регрессии в виде линейного полинома от двух переменных
2. Провести расчеты в матричной форме с использованием центрирования факторов
3. Проверить адекватность модели по критерию Фишера
4. Оценить значимость каждого фактора по критерию Стьюдента
5. При необходимости выполнить селекцию факторов
6. Построить окончательное уравнение регрессии

---

## Исходные данные

**Вариант 7, таблица 5.1:**

| № | x₁  | x₂  | y    |
|---|-----|-----|------|
| 1 | 1.0 | 1.0 | 2.0  |
| 2 | 0.5 | 2.0 | 4.3  |
| 3 | 3.0 | 2.0 | 7.2  |
| 4 | 2.0 | 3.0 | 8.0  |
| 5 | 1.0 | 0.3 | 0.0  |
| 6 | -2.0| 0.5 | -3.0 |

Количество экспериментов: **n = 6**

---

## Методика выполнения

Программа выполняет следующие этапы:

### Шаг 1: Центрирование факторов

Вычисляются средние значения:
```
x̄₁ = Σx₁ᵢ / n
x̄₂ = Σx₂ᵢ / n
ȳ = Σyᵢ / n
```

Выполняется центрирование:
```
x̃₁ᵢ = x₁ᵢ - x̄₁
x̃₂ᵢ = x₂ᵢ - x̄₂
ỹᵢ = yᵢ - ȳ
```

### Шаг 2: Составление матричного уравнения

Формируется матрица центрированных факторов **X** и вектор центрированных значений **Y**.

Вычисляются:
- Матрица Грама: `X'X`
- Вектор: `X'Y`

### Шаг 3: Решение матричного уравнения

Решается система: `(X'X)b = X'Y`

Коэффициенты для центрированных переменных:
```
b = (X'X)⁻¹ X'Y
```

Свободный член для исходных переменных:
```
b₀ = ȳ - b₁·x̄₁ - b₂·x̄₂
```

Итоговое уравнение:
```
ŷ = b₀ + b₁·x₁ + b₂·x₂
```

### Шаг 4: Проверка адекватности по критерию Фишера

Вычисляются:
- Суммы квадратов: SST, SSR, SSE
- Степени свободы: df_reg, df_res
- Средние квадраты: MSR, MSE
- F-статистика: F = MSR / MSE
- Критическое значение: F_критич

Сравнивается F с F_критич для проверки адекватности модели.

Вычисляется коэффициент детерминации R².

### Шаг 5: Селекция факторов по критерию Стьюдента

Для каждого коэффициента вычисляются:
- Стандартная ошибка: SE(bᵢ)
- t-статистика: t(bᵢ) = bᵢ / SE(bᵢ)

Сравнивается |t(bᵢ)| с t_критич для определения значимости каждого фактора.

### Шаг 6: Повторная проверка адекватности

Если есть незначимые факторы:
- Строится редуцированная модель только со значимыми факторами
- Повторно проверяется адекватность по критерию Фишера

---

## Результаты выполнения

При запуске программы `python lab5.py` получены следующие результаты:

### 1. Центрированные данные

```
Средние значения:
  x̄₁ = 0.9167
  x̄₂ = 1.4667
  ȳ  = 3.0833

Центрированные данные:
№  x1-x̄₁    x2-x̄₂      y-ȳ
----------------------------------------
  1     0.0833     -0.4667     -1.0833
  2    -0.4167      0.5333      1.2167
  3     2.0833      0.5333      4.1167
  4     1.0833      1.5333      4.9167
  5     0.0833     -1.1667     -3.0833
  6    -2.9167     -0.9667     -6.0833
```

### 2. Уравнение регрессии

**Для центрированных переменных:**
```
(y - 3.0833) = 2.201389·(x₁ - 0.9167) + 1.808333·(x₂ - 1.4667)
```

**Для исходных переменных:**
```
ŷ = -2.734722 + 2.201389·x₁ + 1.808333·x₂
```

### 3. Проверка адекватности по критерию Фишера

```
Суммы квадратов:
  SST (общая)       = 98.183333
  SSR (регрессия)   = 98.150000
  SSE (остаточная)  = 0.033333

Степени свободы:
  df_регрессия = 2
  df_остаток   = 3

F-статистика:
  F = 4407.750000

Критическое значение:
  F_критич(α=0.05, df1=2, df2=3) = 9.552094

ПРОВЕРКА АДЕКВАТНОСТИ:
  F_расч (4407.750000) > F_критич (9.552094)
  ✓ Уравнение регрессии АДЕКВАТНО экспериментальным данным

Коэффициент детерминации:
  R² = 0.999661
  Регрессия объясняет 99.97% вариации зависимой переменной
```

### 4. Селекция факторов по критерию Стьюдента

```
Стандартные ошибки коэффициентов:
  SE(b₁) = 0.018609
  SE(b₂) = 0.030197

t-статистики:
  t(b₁) = 118.294898
  t(b₂) = 59.881991

Критическое значение:
  t_критич(α/2=0.025, df=3) = 3.182446

ПРОВЕРКА ЗНАЧИМОСТИ ФАКТОРОВ:

Фактор x₁:
  |t(b₁)| = 118.294898 > t_критич = 3.182446
  ✓ Фактор x₁ ЗНАЧИМ

Фактор x₂:
  |t(b₂)| = 59.881991 > t_критич = 3.182446
  ✓ Фактор x₂ ЗНАЧИМ

Итого: Количество значимых факторов: 2
  Значимые факторы: x1, x2
```

### 5. Итоговые результаты

```
Полное уравнение регрессии:
  ŷ = -2.734722 + 2.201389·x₁ + 1.808333·x₂

Статистические характеристики:
  R² = 0.999661 (99.97%)
  F-статистика = 4407.750000
  Адекватность: ДА

Значимость факторов (α = 0.05):
  x₁: ЗНАЧИМ (|t| = 118.2949, t_крит = 3.1824)
  x₂: ЗНАЧИМ (|t| = 59.8820, t_крит = 3.1824)
```

---

## Анализ результатов

### 1. Адекватность модели

F-статистика равна **4407.75**, что **значительно превышает** критическое значение **9.55**. Это означает, что построенная регрессионная модель **адекватна** и хорошо описывает экспериментальные данные.

Коэффициент детерминации **R² = 0.9997** показывает, что модель объясняет **99.97%** вариации зависимой переменной. Это исключительно высокое значение, указывающее на практически идеальную подгонку модели к данным.

### 2. Значимость факторов

Оба фактора оказались **высоко значимыми**:

- **Фактор x₁:** |t| = 118.29 >> t_критич = 3.18
  - Фактор x₁ оказывает очень сильное влияние на отклик y

- **Фактор x₂:** |t| = 59.88 >> t_критич = 3.18
  - Фактор x₂ также оказывает сильное влияние на отклик y, хотя и меньшее, чем x₁

Оба t-значения **на порядки превышают** критическое значение, что говорит о **безусловной значимости** обоих факторов.

### 3. Интерпретация коэффициентов

Итоговое уравнение:
```
ŷ = -2.735 + 2.201·x₁ + 1.808·x₂
```

- **b₀ = -2.735** — значение y при x₁ = x₂ = 0
- **b₁ = 2.201** — при увеличении x₁ на единицу (при фиксированном x₂) y увеличивается на 2.201
- **b₂ = 1.808** — при увеличении x₂ на единицу (при фиксированном x₁) y увеличивается на 1.808

Таким образом, фактор **x₁ оказывает больший эффект** на отклик, чем x₂.

### 4. Качество модели

Остаточная сумма квадратов **SSE = 0.033** очень мала по сравнению с общей суммой квадратов **SST = 98.18**, что подтверждает высокую точность модели.

Максимальная абсолютная ошибка предсказания для отдельных точек не превышает 0.08, что является отличным результатом.

### 5. Центрирование переменных

Использование центрированных переменных:
- Упростило вычисления (матрица X не содержит столбец единиц)
- Позволило избежать вычислительных проблем с обусловленностью матрицы
- Сделало интерпретацию коэффициентов более наглядной

---

## Выводы

1. **Построена адекватная регрессионная модель** вида:
   ```
   ŷ = -2.735 + 2.201·x₁ + 1.808·x₂
   ```
   с коэффициентом детерминации R² = 0.9997

2. **Модель адекватна** по критерию Фишера: F = 4407.75 >> F_критич = 9.55

3. **Оба фактора значимы** по критерию Стьюдента:
   - x₁: |t| = 118.29 >> t_критич = 3.18
   - x₂: |t| = 59.88 >> t_критич = 3.18

4. Фактор **x₁ оказывает большее влияние** на отклик (коэффициент 2.201), чем фактор x₂ (коэффициент 1.808)

5. **Селекция факторов не требуется**, так как оба фактора высоко значимы

6. Модель объясняет **99.97% вариации** зависимой переменной и может быть использована для предсказания значений y при заданных x₁ и x₂

7. Применение **матричной формы** с центрированием переменных обеспечило:
   - Высокую вычислительную эффективность
   - Хорошую численную устойчивость
   - Упрощение формул для расчета коэффициентов

8. Практическая значимость: полученная модель может быть использована для **прогнозирования** значений отклика y при новых значениях факторов x₁ и x₂ с высокой точностью

---

## Запуск программы

### Установка зависимостей

```bash
# Создание виртуального окружения (опционально)
python3 -m venv venv
source venv/bin/activate  # для Linux/Mac
# или
venv\Scripts\activate  # для Windows

# Установка библиотек
pip install -r requirements.txt
```

### Запуск

```bash
python lab5.py
```

### Зависимости

- Python 3.8+
- numpy >= 1.24.0
- scipy >= 1.10.0

---

## Структура проекта

```
lab5/
├── lab5.py              # Основной файл программы
├── requirements.txt     # Зависимости проекта
├── README.md           # Документация (этот файл)
└── oed_5lab.pdf        # Задание (вариант 7)
```

---

## Автор

Лабораторная работа № 5 по курсу "Основы экспериментальных данных"

---

## Литература

1. Дрейпер Н., Смит Г. Прикладной регрессионный анализ. М.: Диалектика, 2007.
2. Кобзарь А.И. Прикладная математическая статистика. М.: Физматлит, 2006.
3. Methodology notes on OED course materials
